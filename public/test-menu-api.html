<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦èœå–® API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .item { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .available { background-color: #e8f5e8; }
        .unavailable { background-color: #ffe8e8; }
    </style>
</head>
<body>
    <h1>èœå–® API æ¸¬è©¦</h1>
    <button onclick="testAPI()">æ¸¬è©¦ API</button>
    <div id="results"></div>

    <script>
        async function testAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>æ­£åœ¨è¼‰å…¥...</p>';
            
            try {
                console.log('ğŸ” é–‹å§‹æ¸¬è©¦ API...');
                
                const response = await fetch("/.netlify/functions/notion-api/databases/23afd5adc30b80c58355fd93d05c66d6/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        page_size: 10
                    })
                });
                
                console.log('ğŸ“¡ API å›æ‡‰ç‹€æ…‹:', response.status);
                
                if (!response.ok) {
                    throw new Error(`API éŒ¯èª¤: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“„ API å›æ‡‰è³‡æ–™:', data);
                
                let html = '<h2>API æ¸¬è©¦çµæœ</h2>';
                
                if (data.results && data.results.length > 0) {
                    html += `<p>æ‰¾åˆ° ${data.results.length} å€‹èœå–®é …ç›®</p>`;
                    
                    data.results.forEach(item => {
                        const props = item.properties;
                        const name = props['åç¨±']?.title?.[0]?.text?.content || 'æœªå‘½å';
                        const price = props['åƒ¹æ ¼']?.number || 0;
                        const category = props['åˆ†é¡']?.select?.name || 'æœªåˆ†é¡';
                        const available = props['ä¾›æ‡‰ç‹€æ…‹']?.checkbox === true;
                        
                        html += `
                            <div class="item ${available ? 'available' : 'unavailable'}">
                                <h3>${name}</h3>
                                <p>åƒ¹æ ¼: NT$ ${price}</p>
                                <p>åˆ†é¡: ${category}</p>
                                <p>ä¾›æ‡‰ç‹€æ…‹: ${available ? 'âœ… å¯ä¾›æ‡‰' : 'âŒ ä¸å¯ä¾›æ‡‰'}</p>
                                <p>éæ¿¾çµæœ: ${available ? 'æœƒé¡¯ç¤º' : 'è¢«éæ¿¾'}</p>
                            </div>
                        `;
                    });
                } else {
                    html += '<p style="color: red;">æ²’æœ‰æ‰¾åˆ°ä»»ä½•èœå–®é …ç›®</p>';
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ API æ¸¬è©¦å¤±æ•—:', error);
                resultsDiv.innerHTML = `<p style="color: red;">éŒ¯èª¤: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
