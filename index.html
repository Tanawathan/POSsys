<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS é»é¤ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- QR Code ç”Ÿæˆåº« -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <!-- ç’°å¢ƒé…ç½® (å¿…é ˆåœ¨å…¶ä»–è…³æœ¬ä¹‹å‰è¼‰å…¥) -->
    <script src="public/env-config.js"></script>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="text-center mb-8">
            <h1 id="restaurant-name" class="text-4xl font-bold text-gray-800 mb-2">é¤å»³é»é¤ç³»çµ±</h1>
            <p class="text-gray-600">æ­¡è¿ä½¿ç”¨æˆ‘å€‘çš„æ•¸ä½é»é¤æœå‹™</p>
        </div>

        <!-- ä¸»è¦ç³»çµ±å°èˆª -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- ç®¡ç†ç³»çµ± -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold text-red-600 mb-4">ğŸ¢ ç®¡ç†ç³»çµ±</h2>
                <p class="text-gray-600 mb-4">åº—å“¡å°ˆç”¨ç®¡ç†ä»‹é¢</p>
                <div class="space-y-2">
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/order-center.html')">ğŸ“‹ è¨‚å–®ç®¡ç†</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/management/menu-management.html')">ğŸ½ï¸ èœå–®ç®¡ç†</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/management/table-management.html')">ğŸª‘ æ¡Œæ³ç®¡ç†</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/management/purchase-management.html')">ğŸ›’ æ¡è³¼ç®¡ç†</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/management/recipe-management.html')">ğŸ‘¨â€ğŸ³ é£Ÿè­œç®¡ç†</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/management/inventory-management.html')">ğŸ“¦ åº«å­˜ç®¡ç†</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/management/cost-analysis.html')">ğŸ’° æˆæœ¬åˆ†æ</button>
                </div>
                <button class="w-full mt-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors" onclick="openManagementDashboard()">é€²å…¥ç®¡ç†å¾Œå°</button>
            </div>

            <!-- å®¢æˆ¶ç«¯ç³»çµ± -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold text-blue-600 mb-4">ğŸ‘¥ å®¢æˆ¶ç«¯ç³»çµ±</h2>
                <p class="text-gray-600 mb-4">å®¢æˆ¶æœå‹™ç›¸é—œåŠŸèƒ½</p>
                <div class="space-y-2">
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/customer/dashboard.html')">ğŸ“Š ä¸»æ§å°å„€è¡¨æ¿</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/customer/reservation.html')">ğŸ“… è¨‚ä½ç®¡ç†</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/customer/customer-view.html')">ğŸ´ å®¢æˆ¶é»é¤ä»‹é¢</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/customer/checkout-new.html')">ğŸ’³ çµå¸³ç³»çµ±</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('public/customer/kds-new.html')">ğŸ³ å»šæˆ¿é¡¯ç¤ºç³»çµ± (KDS)</button>
                </div>
                <button class="w-full mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors" onclick="startOrdering()">é¡§å®¢é»é¤</button>
            </div>

            <!-- å·¥å…·å’Œæ¸¬è©¦ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold text-green-600 mb-4">ğŸ”§ å·¥å…·å’Œæ¸¬è©¦</h2>
                <p class="text-gray-600 mb-4">ç³»çµ±é…ç½®èˆ‡æ¸¬è©¦å·¥å…·</p>
                <div class="space-y-2">
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/notion-database-setup.html')">ğŸ—„ï¸ è³‡æ–™åº«è¨­å®šå·¥å…·</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/tools/csv-notion-sync.html')">ğŸ”„ CSV-Notion åŒæ­¥å·¥å…·</button>
                    <button class="w-full text-left p-2 rounded hover:bg-gray-100 transition-colors" onclick="openPage('pages/tools/system-test.html')">ğŸ§ª ç³»çµ±æ¸¬è©¦å·¥å…·</button>
                </div>
                <button class="w-full mt-4 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors" onclick="openPage('pages/tools/')">å·¥å…·ç®±</button>
            </div>
        </div>

        <!-- QR Code ç”Ÿæˆå€åŸŸ -->
        <div class="mt-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">æ¡Œè™Ÿ QR Code ç”Ÿæˆ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¸æ“‡æ¡Œè™Ÿ:</label>
                        <select id="tableSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">è«‹é¸æ“‡æ¡Œè™Ÿ</option>
                        </select>
                        <button class="mt-4 bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors w-full" onclick="generateQRCode()">ç”Ÿæˆ QR Code</button>
                    </div>
                    <div class="text-center">
                        <div id="qrcode" class="inline-block p-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 min-h-[200px] flex items-center justify-center">
                            <p class="text-gray-500">é¸æ“‡æ¡Œè™Ÿå¾Œç”Ÿæˆ QR Code</p>
                        </div>
                        <button id="downloadBtn" class="mt-4 bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition-colors hidden" onclick="downloadQRCode()">ä¸‹è¼‰ QR Code</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">ç³»çµ±ç‹€æ…‹</h2>
                <div id="system-status">
                    <p class="text-gray-600">æ­£åœ¨æª¢æŸ¥ç³»çµ±é€£ç·š...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        function initApp() {
            // è¨­ç½®é¤å»³åç¨±
            if (window.ENV_CONFIG && window.ENV_CONFIG.RESTAURANT_NAME) {
                document.getElementById('restaurant-name').textContent = window.ENV_CONFIG.RESTAURANT_NAME;
                document.title = window.ENV_CONFIG.RESTAURANT_NAME + ' - é»é¤ç³»çµ±';
            }

            // åˆå§‹åŒ–æ¡Œè™Ÿé¸é …
            initTableOptions();

            // æª¢æŸ¥ç³»çµ±ç‹€æ…‹
            checkSystemStatus();
        }

        // åˆå§‹åŒ–æ¡Œè™Ÿé¸é …
        function initTableOptions() {
            const tableSelect = document.getElementById('tableSelect');
            // ç”Ÿæˆ 1-20 æ¡Œçš„é¸é …
            for (let i = 1; i <= 20; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i} è™Ÿæ¡Œ`;
                tableSelect.appendChild(option);
            }
        }

        // ç”Ÿæˆ QR Code
        function generateQRCode() {
            const tableNumber = document.getElementById('tableSelect').value;
            if (!tableNumber) {
                alert('è«‹å…ˆé¸æ“‡æ¡Œè™Ÿ');
                return;
            }

            // æ§‹å»ºé»é¤ URL
            const baseUrl = window.location.origin;
            const orderUrl = `${baseUrl}/customer/?table=${tableNumber}`;
            
            // æ¸…ç©ºèˆŠçš„ QR Code
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';

            // ç”Ÿæˆæ–°çš„ QR Code
            QRCode.toCanvas(qrContainer, orderUrl, {
                width: 200,
                height: 200,
                colorDark: '#000000',
                colorLight: '#ffffff',
                margin: 2,
                errorCorrectionLevel: 'H'
            }, function (error) {
                if (error) {
                    console.error('QR Code ç”Ÿæˆå¤±æ•—:', error);
                    qrContainer.innerHTML = '<p class="text-red-500">QR Code ç”Ÿæˆå¤±æ•—</p>';
                } else {
                    console.log('QR Code ç”ŸæˆæˆåŠŸ!');
                    // é¡¯ç¤ºä¸‹è¼‰æŒ‰éˆ•
                    document.getElementById('downloadBtn').classList.remove('hidden');
                    
                    // æ·»åŠ æ¡Œè™Ÿæ¨™ç±¤
                    const label = document.createElement('p');
                    label.className = 'mt-2 font-semibold text-gray-800';
                    label.textContent = `${tableNumber} è™Ÿæ¡Œ`;
                    qrContainer.appendChild(label);
                }
            });
        }

        // ä¸‹è¼‰ QR Code
        function downloadQRCode() {
            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) {
                alert('è«‹å…ˆç”Ÿæˆ QR Code');
                return;
            }

            const tableNumber = document.getElementById('tableSelect').value;
            const link = document.createElement('a');
            link.download = `æ¡Œè™Ÿ${tableNumber}_QRCode.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // æ–°å¢é é¢å°èˆªåŠŸèƒ½
        function openPage(pagePath) {
            // æª¢æŸ¥æ˜¯å¦éœ€è¦å¯†ç¢¼é©—è­‰ï¼ˆç®¡ç†ç³»çµ±é é¢ï¼‰
            if (pagePath.includes('management/')) {
                const password = prompt('è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼ï¼š');
                if (password !== 'admin123') {
                    if (password) {
                        alert('å¯†ç¢¼éŒ¯èª¤');
                    }
                    return;
                }
            }
            
            // é–‹å•Ÿé é¢
            window.open(pagePath, '_blank');
        }

        function openManagementDashboard() {
            const password = prompt('è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼ï¼š');
            if (password === 'admin123') {
                window.open('pages/management/dashboard.html', '_blank');
            } else if (password) {
                alert('å¯†ç¢¼éŒ¯èª¤');
            }
        }

        function checkSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            
            if (window.ENV_CONFIG) {
                const hasRequiredConfig = window.ENV_CONFIG.NOTION_API_KEY && 
                                        window.ENV_CONFIG.MENU_DATABASE_ID;
                
                if (hasRequiredConfig) {
                    statusDiv.innerHTML = '<div class="bg-green-100 text-green-800 p-3 rounded">âœ… ç³»çµ±é‹è¡Œæ­£å¸¸</div>';
                } else {
                    statusDiv.innerHTML = '<div class="bg-yellow-100 text-yellow-800 p-3 rounded">âš ï¸ ç³»çµ±é…ç½®ä¸å®Œæ•´ï¼Œè«‹è¯ç¹«æŠ€è¡“æ”¯æ´</div>';
                }
            } else {
                statusDiv.innerHTML = '<div class="bg-red-100 text-red-800 p-3 rounded">âŒ ç„¡æ³•è¼‰å…¥ç³»çµ±é…ç½®</div>';
            }
        }

        function startOrdering() {
            const tableNumber = prompt('è«‹è¼¸å…¥æ¡Œè™Ÿ (1-20):');
            if (tableNumber && tableNumber >= 1 && tableNumber <= 20) {
                const orderUrl = `${window.location.origin}/customer/?table=${tableNumber}`;
                window.open(orderUrl, '_blank');
            } else if (tableNumber) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ¡Œè™Ÿ (1-20)');
            }
        }

        function openManagement() {
            // ä¿ç•™åŸæœ‰çš„ç®¡ç†åŠŸèƒ½ï¼Œç¾åœ¨é‡å®šå‘åˆ°ç®¡ç†å„€è¡¨æ¿
            openManagementDashboard();
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
