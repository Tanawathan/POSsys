<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº«å­˜ç³»çµ±ä¿®å¾©æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- è¼‰å…¥ç’°å¢ƒé…ç½® -->
    <script src="/public/env-config.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">
            <i class="fas fa-tools text-blue-600"></i>
            åº«å­˜ç³»çµ±ä¿®å¾©æ¸¬è©¦
        </h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- ENV_CONFIG æ¸¬è©¦ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-cog text-green-600"></i>
                    ENV_CONFIG æ¸¬è©¦
                </h2>
                <div id="env-test-results" class="space-y-2">
                    <div class="text-gray-500">æº–å‚™æ¸¬è©¦ç’°å¢ƒé…ç½®...</div>
                </div>
                <button id="test-env-btn" class="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                    <i class="fas fa-play"></i>
                    æ¸¬è©¦ ENV_CONFIG
                </button>
            </div>

            <!-- InventoryManager æ¸¬è©¦ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-warehouse text-blue-600"></i>
                    InventoryManager æ¸¬è©¦
                </h2>
                <div id="inventory-test-results" class="space-y-2">
                    <div class="text-gray-500">æº–å‚™æ¸¬è©¦åº«å­˜ç®¡ç†å™¨...</div>
                </div>
                <button id="test-inventory-btn" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-play"></i>
                    æ¸¬è©¦ InventoryManager
                </button>
            </div>
        </div>

        <!-- ç¶œåˆæ¸¬è©¦çµæœ -->
        <div class="mt-6 bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-clipboard-check text-purple-600"></i>
                ç¶œåˆæ¸¬è©¦çµæœ
            </h2>
            <div id="overall-results" class="space-y-2">
                <div class="text-gray-500">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¬è©¦ ENV_CONFIG
        function testEnvConfig() {
            const resultsDiv = document.getElementById('env-test-results');
            const results = [];

            try {
                // æª¢æŸ¥ ENV_CONFIG æ˜¯å¦å­˜åœ¨
                if (typeof window.ENV_CONFIG !== 'undefined') {
                    results.push('<div class="text-green-600">âœ… ENV_CONFIG å·²è¼‰å…¥</div>');
                    
                    // æª¢æŸ¥é—œéµé…ç½®é …ç›®
                    const keys = ['NOTION_API_KEY', 'MENU_DATABASE_ID', 'RESTAURANT_NAME', 'API_BASE_URL'];
                    keys.forEach(key => {
                        if (window.ENV_CONFIG[key]) {
                            results.push(`<div class="text-green-600">âœ… ${key}: å·²é…ç½®</div>`);
                        } else {
                            results.push(`<div class="text-yellow-600">âš ï¸ ${key}: æœªé…ç½®æˆ–ç‚ºç©º</div>`);
                        }
                    });
                } else {
                    results.push('<div class="text-red-600">âŒ ENV_CONFIG æœªè¼‰å…¥</div>');
                }
            } catch (error) {
                results.push(`<div class="text-red-600">âŒ éŒ¯èª¤: ${error.message}</div>`);
            }

            resultsDiv.innerHTML = results.join('');
            updateOverallResults();
        }

        // æ¸¬è©¦ InventoryManager
        async function testInventoryManager() {
            const resultsDiv = document.getElementById('inventory-test-results');
            const results = [];

            try {
                // æª¢æŸ¥ InventoryManager æ˜¯å¦å­˜åœ¨
                if (typeof InventoryManager !== 'undefined') {
                    results.push('<div class="text-green-600">âœ… InventoryManager é¡åˆ¥å·²è¼‰å…¥</div>');
                    
                    // å˜—è©¦å‰µå»ºå¯¦ä¾‹
                    try {
                        const manager = new InventoryManager(false); // ä¸è‡ªå‹•åˆå§‹åŒ–
                        results.push('<div class="text-green-600">âœ… InventoryManager å¯¦ä¾‹å‰µå»ºæˆåŠŸ</div>');
                        
                        // æª¢æŸ¥æ–¹æ³•
                        const methods = ['loadFromNotion', 'renderTable', 'updateStatistics', 'bindEvents'];
                        methods.forEach(method => {
                            if (typeof manager[method] === 'function') {
                                results.push(`<div class="text-green-600">âœ… æ–¹æ³• ${method} å­˜åœ¨</div>`);
                            } else {
                                results.push(`<div class="text-red-600">âŒ æ–¹æ³• ${method} ä¸å­˜åœ¨</div>`);
                            }
                        });
                    } catch (error) {
                        results.push(`<div class="text-red-600">âŒ ç„¡æ³•å‰µå»ºå¯¦ä¾‹: ${error.message}</div>`);
                    }
                } else {
                    results.push('<div class="text-red-600">âŒ InventoryManager é¡åˆ¥æœªè¼‰å…¥</div>');
                    
                    // å˜—è©¦è¼‰å…¥è…³æœ¬
                    results.push('<div class="text-blue-600">ğŸ”„ å˜—è©¦è¼‰å…¥ InventoryManager...</div>');
                    const script = document.createElement('script');
                    script.src = '/assets/js/inventory-management.js';
                    script.onload = () => {
                        results.push('<div class="text-green-600">âœ… InventoryManager è…³æœ¬è¼‰å…¥æˆåŠŸ</div>');
                        resultsDiv.innerHTML = results.join('');
                    };
                    script.onerror = () => {
                        results.push('<div class="text-red-600">âŒ InventoryManager è…³æœ¬è¼‰å…¥å¤±æ•—</div>');
                        resultsDiv.innerHTML = results.join('');
                    };
                    document.head.appendChild(script);
                }
            } catch (error) {
                results.push(`<div class="text-red-600">âŒ éŒ¯èª¤: ${error.message}</div>`);
            }

            resultsDiv.innerHTML = results.join('');
            updateOverallResults();
        }

        // æ›´æ–°ç¶œåˆçµæœ
        function updateOverallResults() {
            const overallDiv = document.getElementById('overall-results');
            const envResults = document.getElementById('env-test-results');
            const inventoryResults = document.getElementById('inventory-test-results');
            
            const envSuccess = envResults.innerHTML.includes('âœ… ENV_CONFIG å·²è¼‰å…¥');
            const inventorySuccess = inventoryResults.innerHTML.includes('âœ… InventoryManager é¡åˆ¥å·²è¼‰å…¥');
            
            let overallStatus = '';
            if (envSuccess && inventorySuccess) {
                overallStatus = '<div class="text-green-600 text-lg font-semibold">ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼ç³»çµ±æ‡‰è©²å¯ä»¥æ­£å¸¸é‹è¡Œã€‚</div>';
            } else if (envSuccess || inventorySuccess) {
                overallStatus = '<div class="text-yellow-600 text-lg font-semibold">âš ï¸ éƒ¨åˆ†æ¸¬è©¦é€šéï¼Œè«‹æª¢æŸ¥å¤±æ•—çš„é …ç›®ã€‚</div>';
            } else {
                overallStatus = '<div class="text-red-600 text-lg font-semibold">âŒ æ¸¬è©¦å¤±æ•—ï¼Œéœ€è¦é€²ä¸€æ­¥æª¢æŸ¥ã€‚</div>';
            }
            
            overallDiv.innerHTML = overallStatus;
        }

        // äº‹ä»¶ç›£è½å™¨
        document.getElementById('test-env-btn').addEventListener('click', testEnvConfig);
        document.getElementById('test-inventory-btn').addEventListener('click', testInventoryManager);

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•é‹è¡Œæ¸¬è©¦
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                testEnvConfig();
                setTimeout(() => {
                    testInventoryManager();
                }, 500);
            }, 1000);
        });
    </script>

    <!-- è¼‰å…¥ InventoryManager -->
    <script src="/assets/js/inventory-management.js"></script>
</body>
</html>