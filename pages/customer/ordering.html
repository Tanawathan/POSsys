<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ¶é»é¤ä»‹é¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">å®¢æˆ¶é»é¤ä»‹é¢</h1>
                <p class="text-gray-600" id="tableInfo">æ¡Œè™Ÿï¼šæœªæŒ‡å®š</p>
            </div>
            <button onclick="window.close()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">è¿”å›</button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- èœå–®å€åŸŸ -->
            <div class="lg:col-span-2">
                <!-- åˆ†é¡æ¨™ç±¤ -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="flex space-x-2 overflow-x-auto">
                        <button onclick="filterCategory('all')" class="category-btn bg-blue-500 text-white px-4 py-2 rounded whitespace-nowrap">å…¨éƒ¨</button>
                        <button onclick="filterCategory('appetizer')" class="category-btn bg-gray-200 text-gray-700 px-4 py-2 rounded whitespace-nowrap">é–‹èƒƒèœ</button>
                        <button onclick="filterCategory('main')" class="category-btn bg-gray-200 text-gray-700 px-4 py-2 rounded whitespace-nowrap">ä¸»é¤</button>
                        <button onclick="filterCategory('drink')" class="category-btn bg-gray-200 text-gray-700 px-4 py-2 rounded whitespace-nowrap">é£²æ–™</button>
                        <button onclick="filterCategory('dessert')" class="category-btn bg-gray-200 text-gray-700 px-4 py-2 rounded whitespace-nowrap">ç”œé»</button>
                    </div>
                </div>

                <!-- èœå–®é …ç›® -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="menuItems">
                    <!-- å‹•æ…‹è¼‰å…¥èœå–®é …ç›® -->
                </div>
            </div>

            <!-- è³¼ç‰©è»Šå€åŸŸ -->
            <div class="bg-white rounded-lg shadow-md p-6 h-fit sticky top-4">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">æ‚¨çš„è¨‚å–®</h3>
                
                <div id="cartItems" class="space-y-3 mb-4">
                    <!-- å‹•æ…‹è¼‰å…¥è³¼ç‰©è»Šé …ç›® -->
                </div>

                <div class="border-t pt-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold">å°è¨ˆï¼š</span>
                        <span class="font-bold text-lg" id="cartTotal">$0</span>
                    </div>
                    <button onclick="submitOrder()" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors" id="submitBtn" disabled>
                        é€å‡ºè¨‚å–®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ“¬èœå–®è³‡æ–™
        const menuData = [
            { id: 1, name: 'å‡±è–©æ²™æ‹‰', category: 'appetizer', price: 180, description: 'æ–°é®®ç”Ÿèœé…ç¶“å…¸å‡±è–©é†¬', image: 'ğŸ¥—' },
            { id: 2, name: 'è’œå‘³éºµåŒ…', category: 'appetizer', price: 120, description: 'é¦™è’œå¥¶æ²¹çƒ¤éºµåŒ…', image: 'ğŸ' },
            { id: 3, name: 'ç‰›æ’', category: 'main', price: 580, description: '8oz é ‚ç´šç‰›æ’', image: 'ğŸ¥©' },
            { id: 4, name: 'ç¾©å¤§åˆ©éºµ', category: 'main', price: 320, description: 'ç¶“å…¸ç•ªèŒ„è‚‰é†¬ç¾©å¤§åˆ©éºµ', image: 'ğŸ' },
            { id: 5, name: 'å¯æ¨‚', category: 'drink', price: 60, description: 'å†°æ¶¼å¯å£å¯æ¨‚', image: 'ğŸ¥¤' },
            { id: 6, name: 'æŸ³æ©™æ±', category: 'drink', price: 80, description: 'ç¾æ¦¨æ–°é®®æŸ³æ©™æ±', image: 'ğŸŠ' },
            { id: 7, name: 'ææ‹‰ç±³è˜‡', category: 'dessert', price: 150, description: 'ç¾©å¼ç¶“å…¸ç”œé»', image: 'ğŸ°' },
            { id: 8, name: 'å†°æ·‡æ·‹', category: 'dessert', price: 100, description: 'é¦™è‰å†°æ·‡æ·‹', image: 'ğŸ¦' }
        ];

        let cart = [];
        let currentCategory = 'all';

        // å¾ URL ç²å–æ¡Œè™Ÿ
        function getTableNumber() {
            const urlParams = new URLSearchParams(window.location.search);
            const tableNumber = urlParams.get('table');
            if (tableNumber) {
                document.getElementById('tableInfo').textContent = `æ¡Œè™Ÿï¼š${tableNumber} è™Ÿæ¡Œ`;
                return tableNumber;
            }
            return null;
        }

        // æ¸²æŸ“èœå–®é …ç›®
        function renderMenuItems() {
            const container = document.getElementById('menuItems');
            container.innerHTML = '';

            const filteredItems = currentCategory === 'all' 
                ? menuData 
                : menuData.filter(item => item.category === currentCategory);

            filteredItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow';
                itemDiv.innerHTML = `
                    <div class="text-4xl mb-2">${item.image}</div>
                    <h4 class="font-semibold text-gray-800 mb-1">${item.name}</h4>
                    <p class="text-gray-600 text-sm mb-2">${item.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-lg text-green-600">$${item.price}</span>
                        <button onclick="addToCart(${item.id})" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                            åŠ å…¥è³¼ç‰©è»Š
                        </button>
                    </div>
                `;
                container.appendChild(itemDiv);
            });
        }

        // åˆ†é¡ç¯©é¸
        function filterCategory(category) {
            currentCategory = category;
            
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.className = 'category-btn bg-gray-200 text-gray-700 px-4 py-2 rounded whitespace-nowrap';
            });
            event.target.className = 'category-btn bg-blue-500 text-white px-4 py-2 rounded whitespace-nowrap';
            
            renderMenuItems();
        }

        // åŠ å…¥è³¼ç‰©è»Š
        function addToCart(itemId) {
            const item = menuData.find(item => item.id === itemId);
            const existingItem = cart.find(cartItem => cartItem.id === itemId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ ...item, quantity: 1 });
            }

            renderCart();
        }

        // æ¸²æŸ“è³¼ç‰©è»Š
        function renderCart() {
            const container = document.getElementById('cartItems');
            const totalElement = document.getElementById('cartTotal');
            const submitBtn = document.getElementById('submitBtn');

            if (cart.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">è³¼ç‰©è»Šç‚ºç©º</p>';
                totalElement.textContent = '$0';
                submitBtn.disabled = true;
                submitBtn.className = 'w-full bg-gray-300 text-gray-500 py-3 rounded-lg cursor-not-allowed';
                return;
            }

            container.innerHTML = '';
            let total = 0;

            cart.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex justify-between items-center p-2 bg-gray-50 rounded';
                itemDiv.innerHTML = `
                    <div class="flex-1">
                        <span class="font-medium">${item.name}</span>
                        <div class="text-sm text-gray-600">$${item.price} x ${item.quantity}</div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="updateQuantity(${index}, -1)" class="bg-red-500 text-white w-6 h-6 rounded text-sm">-</button>
                        <span class="w-8 text-center">${item.quantity}</span>
                        <button onclick="updateQuantity(${index}, 1)" class="bg-green-500 text-white w-6 h-6 rounded text-sm">+</button>
                    </div>
                `;
                container.appendChild(itemDiv);
                total += item.price * item.quantity;
            });

            totalElement.textContent = `$${total}`;
            submitBtn.disabled = false;
            submitBtn.className = 'w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors';
        }

        // æ›´æ–°æ•¸é‡
        function updateQuantity(index, change) {
            cart[index].quantity += change;
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            renderCart();
        }

        // é€å‡ºè¨‚å–®
        function submitOrder() {
            if (cart.length === 0) return;

            const tableNumber = getTableNumber();
            const orderData = {
                table: tableNumber,
                items: cart,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                timestamp: new Date().toISOString()
            };

            // é€™è£¡å¯ä»¥ç™¼é€åˆ°å¾Œç«¯ API
            console.log('è¨‚å–®è³‡æ–™:', orderData);
            
            alert(`è¨‚å–®é€å‡ºæˆåŠŸï¼\næ¡Œè™Ÿï¼š${tableNumber}\nç¸½é‡‘é¡ï¼š$${orderData.total}\n\nè¨‚å–®å°‡æœƒé€åˆ°å»šæˆ¿æº–å‚™ã€‚`);
            
            // æ¸…ç©ºè³¼ç‰©è»Š
            cart = [];
            renderCart();
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            getTableNumber();
            renderMenuItems();
            renderCart();
        });
    </script>
</body>
</html>
