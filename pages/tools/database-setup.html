<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡æ–™åº«è¨­å®šå·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">è³‡æ–™åº«è¨­å®šå·¥å…·</h1>
            <button onclick="window.close()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">è¿”å›</button>
        </div>

        <!-- Notion API è¨­å®š -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ”— Notion API è¨­å®š</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Notion API Token</label>
                    <input type="password" id="notionToken" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="secret_...">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">èœå–®è³‡æ–™åº« ID</label>
                    <input type="text" id="menuDbId" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="è³‡æ–™åº« ID">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">è¨‚å–®è³‡æ–™åº« ID</label>
                    <input type="text" id="orderDbId" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="è³‡æ–™åº« ID">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">åº«å­˜è³‡æ–™åº« ID</label>
                    <input type="text" id="inventoryDbId" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="è³‡æ–™åº« ID">
                </div>
            </div>
            <div class="mt-4 flex space-x-3">
                <button onclick="testNotionConnection()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">æ¸¬è©¦é€£ç·š</button>
                <button onclick="saveNotionConfig()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">å„²å­˜è¨­å®š</button>
                <button onclick="loadNotionConfig()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">è¼‰å…¥è¨­å®š</button>
            </div>
            <div id="notionStatus" class="mt-4"></div>
        </div>

        <!-- è³‡æ–™åº«åˆå§‹åŒ– -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ—„ï¸ è³‡æ–™åº«åˆå§‹åŒ–</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="initMenuDatabase()" class="bg-purple-500 text-white p-4 rounded-lg hover:bg-purple-600">
                    <div class="text-lg font-semibold">åˆå§‹åŒ–èœå–®è³‡æ–™åº«</div>
                    <div class="text-sm opacity-90">å»ºç«‹èœå–®é …ç›®çµæ§‹</div>
                </button>
                <button onclick="initOrderDatabase()" class="bg-orange-500 text-white p-4 rounded-lg hover:bg-orange-600">
                    <div class="text-lg font-semibold">åˆå§‹åŒ–è¨‚å–®è³‡æ–™åº«</div>
                    <div class="text-sm opacity-90">å»ºç«‹è¨‚å–®è¿½è¹¤çµæ§‹</div>
                </button>
                <button onclick="initInventoryDatabase()" class="bg-indigo-500 text-white p-4 rounded-lg hover:bg-indigo-600">
                    <div class="text-lg font-semibold">åˆå§‹åŒ–åº«å­˜è³‡æ–™åº«</div>
                    <div class="text-sm opacity-90">å»ºç«‹åº«å­˜ç®¡ç†çµæ§‹</div>
                </button>
            </div>
            <div id="initStatus" class="mt-4"></div>
        </div>

        <!-- è³‡æ–™å‚™ä»½èˆ‡é‚„åŸ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">ğŸ’¾ è³‡æ–™å‚™ä»½èˆ‡é‚„åŸ</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold mb-3">è³‡æ–™å‚™ä»½</h3>
                    <div class="space-y-2">
                        <button onclick="backupMenuData()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">å‚™ä»½èœå–®è³‡æ–™</button>
                        <button onclick="backupOrderData()" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">å‚™ä»½è¨‚å–®è³‡æ–™</button>
                        <button onclick="backupAllData()" class="w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600">å®Œæ•´å‚™ä»½</button>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-3">è³‡æ–™é‚„åŸ</h3>
                    <div class="space-y-2">
                        <input type="file" id="restoreFile" accept=".json" class="w-full p-2 border border-gray-300 rounded">
                        <button onclick="restoreData()" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">é‚„åŸè³‡æ–™</button>
                        <p class="text-sm text-gray-600">âš ï¸ é‚„åŸå°‡è¦†è“‹ç¾æœ‰è³‡æ–™</p>
                    </div>
                </div>
            </div>
            <div id="backupStatus" class="mt-4"></div>
        </div>
    </div>

    <script>
        // æ¸¬è©¦ Notion é€£ç·š
        function testNotionConnection() {
            const token = document.getElementById('notionToken').value;
            const statusDiv = document.getElementById('notionStatus');
            
            if (!token) {
                statusDiv.innerHTML = '<div class="bg-red-100 text-red-800 p-3 rounded">è«‹è¼¸å…¥ Notion API Token</div>';
                return;
            }

            statusDiv.innerHTML = '<div class="bg-blue-100 text-blue-800 p-3 rounded">æ¸¬è©¦é€£ç·šä¸­...</div>';
            
            // æ¨¡æ“¬ API æ¸¬è©¦
            setTimeout(() => {
                const success = Math.random() > 0.3; // 70% æˆåŠŸç‡æ¨¡æ“¬
                if (success) {
                    statusDiv.innerHTML = '<div class="bg-green-100 text-green-800 p-3 rounded">âœ… é€£ç·šæˆåŠŸï¼</div>';
                } else {
                    statusDiv.innerHTML = '<div class="bg-red-100 text-red-800 p-3 rounded">âŒ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Token æ˜¯å¦æ­£ç¢º</div>';
                }
            }, 2000);
        }

        // å„²å­˜ Notion è¨­å®š
        function saveNotionConfig() {
            const config = {
                token: document.getElementById('notionToken').value,
                menuDbId: document.getElementById('menuDbId').value,
                orderDbId: document.getElementById('orderDbId').value,
                inventoryDbId: document.getElementById('inventoryDbId').value
            };

            if (!config.token) {
                alert('è«‹è¼¸å…¥ Notion API Token');
                return;
            }

            localStorage.setItem('notionConfig', JSON.stringify(config));
            document.getElementById('notionStatus').innerHTML = '<div class="bg-green-100 text-green-800 p-3 rounded">è¨­å®šå·²å„²å­˜ï¼</div>';
        }

        // è¼‰å…¥ Notion è¨­å®š
        function loadNotionConfig() {
            const config = localStorage.getItem('notionConfig');
            if (config) {
                const parsed = JSON.parse(config);
                document.getElementById('notionToken').value = parsed.token || '';
                document.getElementById('menuDbId').value = parsed.menuDbId || '';
                document.getElementById('orderDbId').value = parsed.orderDbId || '';
                document.getElementById('inventoryDbId').value = parsed.inventoryDbId || '';
                document.getElementById('notionStatus').innerHTML = '<div class="bg-blue-100 text-blue-800 p-3 rounded">è¨­å®šå·²è¼‰å…¥ï¼</div>';
            } else {
                document.getElementById('notionStatus').innerHTML = '<div class="bg-yellow-100 text-yellow-800 p-3 rounded">æœªæ‰¾åˆ°å„²å­˜çš„è¨­å®š</div>';
            }
        }

        // åˆå§‹åŒ–è³‡æ–™åº«
        function initMenuDatabase() {
            showInitStatus('æ­£åœ¨åˆå§‹åŒ–èœå–®è³‡æ–™åº«...', 'blue');
            setTimeout(() => {
                showInitStatus('âœ… èœå–®è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆï¼', 'green');
            }, 2000);
        }

        function initOrderDatabase() {
            showInitStatus('æ­£åœ¨åˆå§‹åŒ–è¨‚å–®è³‡æ–™åº«...', 'blue');
            setTimeout(() => {
                showInitStatus('âœ… è¨‚å–®è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆï¼', 'green');
            }, 2000);
        }

        function initInventoryDatabase() {
            showInitStatus('æ­£åœ¨åˆå§‹åŒ–åº«å­˜è³‡æ–™åº«...', 'blue');
            setTimeout(() => {
                showInitStatus('âœ… åº«å­˜è³‡æ–™åº«åˆå§‹åŒ–å®Œæˆï¼', 'green');
            }, 2000);
        }

        function showInitStatus(message, color) {
            const statusDiv = document.getElementById('initStatus');
            statusDiv.innerHTML = `<div class="bg-${color}-100 text-${color}-800 p-3 rounded">${message}</div>`;
        }

        // å‚™ä»½åŠŸèƒ½
        function backupMenuData() {
            showBackupStatus('æ­£åœ¨å‚™ä»½èœå–®è³‡æ–™...', 'blue');
            setTimeout(() => {
                const data = { type: 'menu', timestamp: new Date().toISOString(), data: [] };
                downloadJSON(data, 'menu_backup.json');
                showBackupStatus('âœ… èœå–®è³‡æ–™å‚™ä»½å®Œæˆï¼', 'green');
            }, 1500);
        }

        function backupOrderData() {
            showBackupStatus('æ­£åœ¨å‚™ä»½è¨‚å–®è³‡æ–™...', 'blue');
            setTimeout(() => {
                const data = { type: 'orders', timestamp: new Date().toISOString(), data: [] };
                downloadJSON(data, 'orders_backup.json');
                showBackupStatus('âœ… è¨‚å–®è³‡æ–™å‚™ä»½å®Œæˆï¼', 'green');
            }, 1500);
        }

        function backupAllData() {
            showBackupStatus('æ­£åœ¨é€²è¡Œå®Œæ•´å‚™ä»½...', 'blue');
            setTimeout(() => {
                const data = { 
                    type: 'full_backup', 
                    timestamp: new Date().toISOString(), 
                    menu: [], 
                    orders: [], 
                    inventory: [] 
                };
                downloadJSON(data, 'full_backup.json');
                showBackupStatus('âœ… å®Œæ•´å‚™ä»½å®Œæˆï¼', 'green');
            }, 3000);
        }

        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            if (!fileInput.files[0]) {
                showBackupStatus('è«‹é¸æ“‡è¦é‚„åŸçš„æª”æ¡ˆ', 'red');
                return;
            }

            if (confirm('ç¢ºå®šè¦é‚„åŸè³‡æ–™å—ï¼Ÿé€™å°‡è¦†è“‹ç¾æœ‰è³‡æ–™ï¼')) {
                showBackupStatus('æ­£åœ¨é‚„åŸè³‡æ–™...', 'blue');
                setTimeout(() => {
                    showBackupStatus('âœ… è³‡æ–™é‚„åŸå®Œæˆï¼', 'green');
                }, 2000);
            }
        }

        function showBackupStatus(message, color) {
            const statusDiv = document.getElementById('backupStatus');
            statusDiv.innerHTML = `<div class="bg-${color}-100 text-${color}-800 p-3 rounded">${message}</div>`;
        }

        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥è¨­å®š
        document.addEventListener('DOMContentLoaded', loadNotionConfig);
    </script>
</body>
</html>
